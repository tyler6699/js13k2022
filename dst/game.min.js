var h,n=!1,a=!1,l={songData:[{i:[0,120,116,79,0,159,116,0,83,0,0,6,69,52,0,0,0,0,0,0,2,7,0,0,37,20,0,1,1],p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[148,,,,148,,,,148,,,,148,,,,148,,,,148,,,,148,,,,148],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,59,0,10,25,55,0,0,0,109,5,0,1,239,112,0,32,64,5,16,4],p:[,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148],f:[]}]},{i:[2,120,128,0,3,215,128,0,0,0,0,37,29,0,0,0,0,195,4,1,3,50,184,119,244,76,6,84,6],p:[,,3,3,3,3,,,3,3,,,3,3],c:[{n:[],f:[]},{n:[],f:[]},{n:[106,,,,,,106],f:[]}]},{i:[2,29,128,0,3,68,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[,,,,,,4,5,,,4,5],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[154,,,,,,,,,,,,,,,,155],f:[]},{n:[152,,,,,,,,,,,,,,,,154],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,216,158,158,158,0,0,0,0,51,2,1,2,58,239,0,32,88,1,157,2],p:[6,,6,,6,,6,,6,,6],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[148,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,148],f:[]}]},{i:[0,21,128,0,0,16,140,0,0,0,154,51,87,61,12,4,0,96,3,1,3,51,160,9,32,84,2,195,3],p:[,,,,,,,,7,,,,7],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[142],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,7,6,22,34,0,0,0,0,69,3,1,1,23,167,255,255,77,6,11,8],p:[,,8,,8,,9,10,,,9,10],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[118,,,,,,118,,,,118],f:[]},{n:[118,,,,,,118,,,,118,,,,,,119,,,,,,119,,,,119],f:[]},{n:[116,,,,,,116,,,,116,,,,,,118,,,,,,118,,,,118],f:[]}]}],rowLen:5513,patternLen:32,endPattern:13,numChannels:7},o=function(){var t,i,e,s,h,n=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},r=function(t,i,e){var s,h,n,r,o,c,u=l[t.i[0]],f=t.i[1],y=t.i[3]/32,d=l[t.i[4]],p=t.i[5],v=t.i[8]/32,x=t.i[9],g=t.i[10]*t.i[10]*4,m=t.i[11]*t.i[11]*4,w=t.i[12]*t.i[12]*4,b=1/w,k=-t.i[13]/16,M=t.i[14],T=e*2**(2-t.i[15]),S=new Int32Array(g+m+w),I=0,L=0;for(s=0,h=0;s<g+m+w;s++,h++)h>=0&&(h-=T,o=a(i+(15&(M=M>>8|(255&M)<<4))+t.i[2]-128),c=a(i+(15&M)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,s<g?n=s/g:s>=g+m&&(n=(1-(n=(s-g-m)*b))*3**(k*n)),r=u(I+=o*n**y)*f,r+=d(L+=c*n**v)*p,x&&(r+=(2*Math.random()-1)*x),S[s]=80*r*n|0;return S},l=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.endPattern,e=0,s=n.rowLen*n.patternLen*(i+1)*2,h=new Int32Array(s)},this.generate=function(){var a,o,c,u,f,y,d,p,v,x,g,m,w,b,k=new Int32Array(s),M=t.songData[e],T=t.rowLen,S=t.patternLen,I=0,L=0,E=!1,D=[];for(c=0;c<=i;++c)for(d=M.p[c],u=0;u<S;++u){var H=d?M.c[d-1].f[u]:0;H&&(M.i[H-1]=M.c[d-1].f[u+S]||0,H<17&&(D=[]));var P=l[M.i[16]],A=M.i[17]/512,R=2**(M.i[18]-9)/T,W=M.i[19],C=M.i[20],O=43.23529*M.i[21]*3.141592/44100,B=1-M.i[22]/255,j=1e-5*M.i[23],N=M.i[24]/32,F=M.i[25]/512,Y=6.283184*2**(M.i[26]-9)/T,z=M.i[27]/255,K=M.i[28]*T&-2;for(g=(c*S+u)*T,f=0;f<4;++f)if(y=d?M.c[d-1].n[u+f*S]:0){D[y]||(D[y]=r(M,y,T));var U=D[y];for(o=0,a=2*g;o<U.length;o++,a+=2)k[a]+=U[o]}for(o=0;o<T;o++)(x=k[p=2*(g+o)])||E?(m=O,W&&(m*=P(R*p)*A+.5),L+=(m=1.5*Math.sin(m))*(w=B*(x-L)-(I+=m*L)),x=3==C?L:1==C?w:I,j&&(x=(x*=j)<1?x>-1?n(.25*x):-1:1,x/=j),E=(x*=N)*x>1e-5,b=x*(1-(v=Math.sin(Y*p)*F+.5)),x*=v):b=0,p>=K&&(b+=k[p-K+1]*z,x+=k[p-K]*z),k[p]=0|b,k[p+1]=0|x,h[p]+=0|b,h[p+1]+=0|x}return++e/t.numChannels},this.createAudioBuffer=function(t){for(var i=t.createBuffer(2,s/2,44100),e=0;e<2;e++)for(var n=i.getChannelData(e),a=e;a<s;a+=2)n[a>>1]=h[a]/65536;return i},this.createWave=function(){var t=44+2*s-8,i=t-36,e=new Uint8Array(44+2*s);e.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var n=0,a=44;n<s;++n){var r=h[n];r=r<-32767?-32767:r>32767?32767:r,e[a++]=255&r,e[a++]=r>>8&255}return e},this.getData=function(t,i){for(var e=2*Math.floor(44100*t),s=new Array(i),n=0;n<2*i;n+=1){var a=e+n;s[n]=t>0&&a<h.length?h[a]/32768:0}return s}},u;function y(){var t=new o;t.init(l),setInterval(function(){if(!n&&(n=t.generate()>=1)){var i=t.createWave();(h=document.createElement("audio")).src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),a=!0}},0)}function d(t,i,e,s,h,n,a,r=At){this.time=0,this.x=e,this.y=s,this.w=t,this.h=i,this.type=n,this.endPos=K(this),this.speed=7,this.angle=Math.atan2(this.endPos.y-this.y,this.endPos.x-this.x),this.remove=!1,this.alpha=1,this.colour="#"+["FF0000","B30000","7D0000","FF8080"][W(0,3)],this.no=1,"dust"==this.type&&(this.colour="#"+["4d1933","EDEDED"][W(0,1)],this.alpha=.1),this.rndCol=a,this.lastDir=r,this.update=function(t,i){if(this.time+=i,t.save(),t.translate(yt.cam.x,yt.cam.y),"circle"==this.type){let i=Math.atan2(this.y-this.endPos.y,this.x-this.endPos.x)+Math.PI+2*(Math.random()-.5);Math.hypot(this.endPos.x-this.x,this.endPos.y-this.y)>=10&&(this.x+=Math.cos(i)*this.speed-6*this.time,this.y+=Math.sin(i)*this.speed-6*this.time),this.alpha-=.01,this.w>1&&(this.w-=.75),t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586);let e=this.rndCol?R():this.colour;t.fillStyle=e,t.fill(),this.time>.6&&(this.remove=!0)}else if("dust"==this.type)this.lastDir==At?this.x-=2:this.x+=2,this.y-=W(1,5)/10,t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586),t.fillStyle=this.colour,t.fill(),this.alpha>.1&&(this.alpha-=.01),this.w+=.1,this.time>.5&&(this.remove=!0);else if("bld"==this.type){t.beginPath(),t.globalAlpha=this.alpha;for(let i=0;i<=this.no;i++)t.arc(this.x,this.y+i,this.w,0,6.283185307179586),t.fillStyle=this.colour,t.fill();W(1,10)>8&&this.no++,this.alpha-=.01,(this.time>2.5||this.alpha<=0)&&(this.remove=!0)}t.globalAlpha=1,t.restore()}}function p(t=0,i=0){this.x=t,this.y=i}var v=[];function x(t,e){for(m=u.createBuffer(1,96e3,48e3),gainNode=u.createGain(),b=m.getChannelData(0),i=96e3;i--;)b[i]=getSound(t,i);s=u.createBufferSource(),s.buffer=m,s.connect(gainNode),gainNode.connect(u.destination),gainNode.gain.value=e,s.start()}function g(i){if(t=((t,i)=>(i-t)/i),i>7e4)return null;t(i,7e4);return Math.sin(.001*i*Math.sin(.009*i)+Math.sin(i/100))}function w(t){if(t>1e4)return null;var i=(1e4-t)/1e4;return(128&Math.pow(t,1.055)?1:-1)*Math.pow(i,2)}function k(t){if(t>5e4)return null;var i=(5e4-t)/5e4;return(200&Math.pow(t,.9)?1:-1)*Math.pow(i,3)}function M(t){var i=1e4;if(t>i)return null;var e=(i-t)/i,s=Math.pow(e,2.1);return Math.pow(t,3)&(t<3333.3333333333335?16:99)?s:-s}function T(t){if(t>2e4)return null;var i=(2e4-t)/2e4;return Math.sin(.003*-t*Math.sin(.09*t+Math.sin(t/200))+Math.sin(t/100))*i*i}function S(t){if(t>1e4)return null;var i=(1e4-t)/1e4;return Math.sin(.01*t*Math.sin(.009*t+Math.sin(t/200))+Math.sin(t/100))*i*i}function I(i){if(i>2e3)return null;t=((t,i)=>(i-t)/i);var e=t(i,2e3);return 33&Math.pow(50*i,.7)?e:-e}function L(i){if(t=((t,i)=>(i-t)/i),i>2e4)return null;var e=t(i,2e4);return i*=.04,Math.sin(.03*-i*Math.sin(.09*i+Math.sin(i/200))+Math.sin(i/100))*e}function E(){var t=!0;this.cam=new p,this.ratio=1,this.tips=!0,this.ratio=q>800?q/800:J/600,this.scale=2,this.cube=16,this.scaled=this.scale*this.cube,this.hero=new G(16,16,40*this.scale,100*this.scale,0,D.HERO,this.scale),this.introT=0,this.shake=0,this.shakeTime=0,this.reset=!1,this.wait=2,this.rawlvls=[],this.rawlvls=[],this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,0,0]]),this.genLevel=function(t){this.levels=[];let e=[130,130,130];for(i=0;i<this.rawlvls.length;i++){var s=new V(i+1,q,J,i,this.scale,e[i],this.rawlvls[i]);s.reset(i,this.scaled),this.levels.push(s)}this.level=this.levels[0],this.hero.e.curLevel=0,this.hero.e.x=this.level.startPos[0],this.hero.e.y=this.level.startPos[1]},this.genLevel(0);var e=this.levels[this.hero.e.curLevel].cols;this.surTiles=[-1,1,e-1,e,e+1,-e-1,-e,1-e],this.update=function(i,e,s=!1){t&&(t=!1,ctx.scale(this.ratio,this.ratio)),this.shake=ft?Math.cos(tt):0,this.hero.setCurrentTile(this.scaled),this.level.draw(this.hero,i),s||(this.hero.update(ctx,i),mt.canvas.style.cursor="none",this.cam.x=U(400-this.hero.e.x-20,this.cam.x,.8),this.cam.y=U(300-this.hero.e.y-80,this.cam.y,.8))}}getSound=function(t,i){var e;switch(t){case Qt:e=g(i);break;case Zt:e=M(i);break;case $t:e=w(i);break;case _t:e=k(i);break;case ti:e=T(i);break;case ii:e=S(i);break;case ei:e=I(i);break;case si:e=L(i);break;default:return 1}return e};const D={AIR:0,BLOCK:1,HERO:2},H={FOLLOW:0,SIMPLE:1};function P(t,i,e,s,h,n,a,r,l,o){this.entity=new X(t,t,i,e,s,h,"",l,0,0),this.column=a,this.row=r,this.active=!0,this.trigger=o,this.e=this.entity,this.update=function(t){this.entity.update(t)},this.change=function(){this.entity.type>=Object.values(D).length&&(this.entity.type=0),this.entity.setType()},this.isTile=function(){return!0}}function A(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}function R(){let t="#";for(var i=0;i<6;i++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}function W(t,i){return Math.floor(Math.random()*(i-t+1)+t)}function C(t){return new A(t.x,t.y,t.w,t.h)}function O(t,i,e,s,h,n,a,r){return t<h+a&&t+e>h&&i<n+r&&i+s>n}function B(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.h&&t.y+t.h>i.y}function j(t,i){this.x=t,this.y=i,this.set=function(t,i){this.x=t,this.y=i}}function N(t,i,e,s,h,n,a,r,l,o,c=0){t.save(),t.globalAlpha=l,t.translate(a,r),c>0&&(t.translate(24,24),t.rotate(c*Math.PI/180),t.translate(-24,-24)),t.drawImage(i,e,s,h,n,h/2,n/2,h*o,n*o),t.restore()}function F(t,i,e,s,h,n,a,r,l){t.save(),t.globalAlpha=l,t.translate(i,e),t.fillStyle=r,t.fillRect(s,h,n,a),t.restore()}function Y(){}function K(t){var i=W(0,360)*Math.PI/180,e=W(50,180),s=[-1,1][W(0,1)]*e;return{x:t.x+s*Math.cos(i),y:t.y+s*Math.sin(i)}}function U(t,i,e){return(1-e)*t+e*i}function V(t,i,e,s,h,n,a){ct=t,this.tiles=[],this.triggers=[],this.breakTiles=[],this.mvTiles=[],this.active=!1,this.roomNo=s,this.opendoors=!1,this.startPos=[0,0],this.doorDrop=n;let l=13;this.cols=24;let o=0;this.draw=function(t,i){this.tiles.forEach(t=>t.update(i)),this.opendoors&&this.mvTiles.forEach(t=>{t.entity.isSolid=!1,o<this.doorDrop?(t.entity.y+=2,o+=1):t.entity.active&&(yt.shakeTime=.1,t.entity.active=!1)}),this.triggers.forEach((i,e)=>{if(!i.trigger)return;i.entity.x,i.entity.hWidth;if(i.entity.type==D.DROPY){if(i.entity.trapactive)i.entity.y+=15;else{let e=t.e.x,s=t.e.x+t.e.width*h,n=i.entity.x,a=i.entity.x+i.entity.width*h;(e>n&&e<a||s>n&&s<a)&&t.e.y-t.e.height>i.entity.y&&(i.entity.trapactive=!0)}B(t.e.hb,i.entity.hb)?(t.bloodSplatter(!1,t.e.x,t.e.y),t.kill(),i.trigger=!1,i.entity.active=!1,i.entity.kills=!1):i.entity.y>1e3&&(i.trigger=!1,i.entity.active=!1)}})},this.reset=function(t,i){this.tiles=[],this.dTiles=[],this.mvTiles=[],this.opendoors=!1,o=0;let e=!1;for(l=a.length,this.cols=a[0].length,r=0;r<l;r++)for(c=0;c<this.cols;c++){let t=a[r][c];e=!1,ts=16*h,xx=c*ts,yy=r*ts;t==D.DROPY&&(e=!0),t==D.HERO&&(t=D.AIR,this.startPos=[xx,yy]),t==D.AIR&&W(0,100)>95&&(t=D.BRICK);var s=new P(16,xx,yy,0,t,!1,c,r,h,e);this.tiles.push(s),1==s.trigger&&this.triggers.push(s),t==D.DOOR&&this.mvTiles.push(s)}}}function X(t,i,e,h,n,a,r,l,o=!1,c=0){this.scale=l,this.type=a,this.width=t,this.height=i,this.mhWidth=t/-2,this.mhHeight=i/-2,this.mhWScaled=t/-2*l,this.mhHScaled=i/-2*l,this.hWidth=t/2,this.hHeight=i/2,this.cenX=e-this.mhWScaled,this.cenY=h-this.mhHScaled,this.angle=n,this.x=e,this.y=h,this.active=!0,this.colour=r,this.image=ut,this.animated=!1,this.spin=!1,this.alpha=1,this.currentTile=0,this.colArr=[],this.isSolid=!1,this.isButton=o,this.time=0,this.maxHP=c,this.hp=this.maxHP,this.breaks=!1,this.flip=!1,this.idle=0,this.pressed=!1,this.kills=!1,this.falls=!1,this.fallTime=0,this.fall=!1,this.chk=!1,this.sx=0,this.sy=0,this.setHitbox=function(){this.hb=new A(0,0,0,0),this.sensor=new A(0,0,0,0),this.isButton&&(this.hb.w=2*this.width,this.hb.h=2*this.height)},this.setHitbox(),this.updateHitbox=function(){this.isButton?(this.hb.x=this.x-this.width,this.hb.y=this.y-this.height):(this.hb.x=this.x+this.scale/2,this.hb.y=this.y+this.scale/2,this.hb.w=this.width*this.scale-this.scale,this.hb.h=this.height*this.scale-this.scale,this.sensor.x=this.x-5,this.sensor.y=this.y-5,this.sensor.w=this.width*this.scale+10,this.sensor.h=this.height*this.scale+10)},this.update=function(e){if(this.idle+=e,this.updateHitbox(),this.active){if(ctx.save(),ctx.translate(this.x,this.y),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,i=this.height,yt.shakeTime>0&&(yt.shakeTime-=e/1e3,ctx.translate(yt.shake,yt.shake)),ctx.translate(yt.cam.x,yt.cam.y),null==this.image)ctx.fillStyle=this.colour,ctx.fillRect(.5*mhw*s,.5*mhh*s,.5*t*s,.5*i*s);else{if(this.flip?(ctx.scale(-1,1),ctx.translate(-t*s-t,0)):ctx.scale(1,1),f=0,z=0,this.angle>0||this.spin){let t=24;ctx.translate(t,t),this.angle=this.spin?this.angle+=8+W(0,5):this.angle,ctx.rotate(this.angle*Math.PI/180),ctx.translate(-t,-t)}ctx.drawImage(img,this.sx,this.sy,t,i,hw+z,hh+f,t*s,i*s)}ctx.restore()}this.cenX=this.x-this.mhWScaled,this.cenY=this.y-this.mhHScaled},this.isHero=function(){return this.type==D.HERO},this.isTile=function(){return!1},this.setT=function(t){this.type=t,this.setType()},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.isSolid=!1,this.type){case D.HERO:this.isSolid=!0,this.sx=0,this.sy=0;break;case D.BLOCK:this.isSolid=!0,this.sx=16;break;case D.AIR:this.sx=144}},this.setType()}function G(t,i,s,h,n,a,r){this.e=new X(t,i,s,h,n,a,"",r,!1,100),this.active=!0,this.hp=2,this.particles=[];let l=null,o=0,c=0,u=0,f=At,y={x:this.e.x,y:this.e.y},p=[],v=0,g=0,m=0,w=0,b=!1;this.deaths=0,this.doneTime=0,this.done=!1,this.changeLevel=!1,this.update=function(t,i){this.time+=i,o+=i,(Math.abs(y.x-this.e.x)>20||Math.abs(y.y-this.e.y)>20)&&(!function(t,i,e){e.length>8&&e.splice(0,1);e.push({x:t,y:i,d:f})}(this.e.x,this.e.y,p),y={x:this.e.x,y:this.e.y}),this.active&&(Tt()||St()?(v+=i,c=c>5?5:c+=.5):(c=c>0?c-=.5:0,v=0),(Tt()||c>0&&f==Pt)&&(f=Pt,this.e.x-=this.gMove(-1,0),this.e.flip=!0,Tt()||this.addDust()),(St()||c>0&&f==At)&&(f=At,this.e.x+=this.gMove(1,0),this.e.flip=!1,St()||this.addDust())),(It()||Et()||Ht()||St()||Tt())&&(o=0),o>3&&(this.e.angle+=40,this.particles.push(new d(W(10,30),0,this.e.x-this.e.mhWScaled,this.e.y+2.2*this.e.height-W(1,5),0,"dust",!1,f)),o>5&&(o=0));for(let e=0;e<=this.particles.length-1;e++)this.particles[e].update(t,i);this.e.update(i),v>.35&&this.addDust(),this.particles=this.particles.filter(function(t){return 0==t.remove}),m=this.e.x-this.e.mhWScaled,w=this.e.y-this.e.mhHScaled},this.reset=function(){this.doneTime=0,this.done=!1,this.particles=[],this.hp=2;let t=yt.levels[this.e.curLevel];this.e.x=t.startPos[0],this.e.y=t.startPos[1]},this.kill=function(){this.active&&(this.deaths++,yt.shakeTime=.15,x(ii,1),this.hp--,p=[],this.active=!1,g=.5,c=0,this.e.sy=16,0==this.hp&&this.hp++)},this.setCurrentTile=function(t){heroRow=Math.floor((this.e.y-this.e.mhHScaled)/t),heroCol=Math.floor((this.e.x-this.e.mhWScaled)/t),heroTileIndex=heroCol+yt.levels[this.e.curLevel].cols*heroRow,null!=l&&(this.prevTile=l),l=yt.level.tiles[heroTileIndex],this.e.x==y.x&&this.e.y==y.y||(this.e.colArr=[],yt.surTiles.forEach(t=>this.e.colArr.push(yt.level.tiles[heroTileIndex+t])))},this.addDust=function(t=!1){if(t)for(let t=0;t<W(5,10);t++)this.particles.push(new d(W(5,10),0,this.e.x-this.e.mhWScaled,this.e.y+2.2*this.e.height-W(1,5),0,"dust",!1,At)),this.particles.push(new d(W(5,10),0,this.e.x-this.e.mhWScaled,this.e.y+2.2*this.e.height-W(1,5),0,"dust",!1,Pt));else for(let t=0;t<W(1,4);t++)this.particles.push(new d(W(1,15),0,this.e.x-this.e.mhWScaled,this.e.y+2.2*this.e.height-W(1,5),0,"dust",!1,f));v=0},this.jump=function(){},this.gMove=function(t,i,s=!1,h=!1,n=!1,a=!1){this.e.idle=0;var r=s?7:c;h?r=u=(u-=.3)>0?u:0:n&&(r=1),a&&(r=1),rec=C(this.e.hb),rec.x+=t*r,rec.y+=i*r,canMove=!0,amount=r;for(var l=r;l>0;l--){canMove=!0;for(var o=0;o<this.e.colArr.length;o++)if(obj=this.e.colArr[o],null!=obj&&null!=obj.entity){if(e=obj.entity,obj.isTile()&&B(e.hb,rec)&&obj.active&&e.isSolid){canMove=!1;break}}else this.e.y>500&&(b=!0);if(canMove)break;amount--,rec.x-=t,rec.y-=i}return amount}}let q=window.innerWidth,J=window.innerHeight,Q=!1,Z=0,$=Date.now(),_=Date.now(),tt=0,it=0,et=new j(0,0),st=new j(0,0),ht=!1,nt=!1,at=!1,rt="990099",lt="05f2db",ot=!1,ct=1,ut=new Image;ut.src="atlas.png";let ft=!0,yt=new E,dt=!0,pt=!1,vt=[],xt=!0,gt=!1;function startGame(){mt.start()}y();let mt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=q,this.canvas.height=J,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(wt,20),yt.genLevel(0),yt.levels[0].tiles.forEach(t=>{t.entity.type>0&&vt.push(t)}),window.addEventListener("keydown",function(t){pt=!0,t.preventDefault(),mt.keys=mt.keys||[],mt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){mt.keys[t.keyCode]="keydown"==t.type,t.keyCode==qt&&(at=!0),t.keyCode==Nt&&(gt=!gt),t.keyCode==Jt&&(yt.tips=!yt.tips)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}};function wt(){if(nt&&(tt=0,nt=!1,ot=!1,ct=0,pt=!1,Q=!1,yt.genLevel(ct)),pt&&(null!=yt.hero&&(yt.hero.e.active=!0),Q=!0),$=_,_=Date.now(),tt+=Z=_-$,Q){mt.clear(),yt.update(Z/1e3,tt);let t="15px Verdana";Mt(ctx,1,t,"WHITE","[M] Music: "+!gt,650,20),Mt(ctx,1,t,"WHITE","[T] Tips: "+yt.tips,650,40),Mt(ctx,1,t,"WHITE","[R] Reset Level",650,60),Mt(ctx,1,t,"WHITE","Lives: "+yt.hero.hp,10,40),Mt(ctx,1,t,"RED","Deaths: "+yt.hero.deaths,10,60),Mt(ctx,1,t,"WHITE","Level: "+(yt.hero.e.curLevel+1),10,20);yt.hero.e.curLevel}else{mt.clear(),ctx=mt.context,yt.update(Z,tt,!0),ctx.save(),bt(ctx,.1,"#"+rt,0,0,800,600),Mt(ctx,1,"20px Verdana","WHITE","Main Screen",50,40),ctx.restore(),ctx.save()}}function bt(t,i,e,s,h,n,a){t.globalAlpha=i,t.fillStyle=e,t.fillRect(s,h,n,a)}function kt(t,i,e,s,h,n,a){var r=eval('"\\u'+h+'"');t.globalAlpha=i,t.font=e,t.fillStyle=s,t.fillText(r,n,a)}function Mt(t,i,e,s,h,n,a){t.globalAlpha=i,t.font=e,t.fillStyle=s,t.fillText(h,n,a)}function Tt(){return mt.keys&&(mt.keys[Pt]||mt.keys[Ot])}function St(){return mt.keys&&(mt.keys[At]||mt.keys[jt])}function It(){return mt.keys&&(mt.keys[Rt]||mt.keys[Ct])}function Lt(){return mt.keys&&(mt.keys[Wt]||mt.keys[Bt])}function Et(){return mt.keys&&mt.keys[zt]}function Dt(){return mt.keys&&mt.keys[Nt]}function Ht(){return mt.keys&&(mt.keys[Ut]||mt.keys[Kt])}var Pt=37,At=39,Rt=38,Wt=40,Ct=87,Ot=65,Bt=83,jt=68,Nt=77,Ft=0,Yt=2,zt=32,Kt=69,Ut=49,Vt=50,Xt=51,Gt=52,qt=82,Jt=84,Qt=0,Zt=1,$t=2,_t=3,ti=4,ii=5,ei=6,si=7;