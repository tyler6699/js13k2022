var h,n=!1,a=!1,o={songData:[{i:[0,120,116,79,0,159,116,0,83,0,0,6,69,52,0,0,0,0,0,0,2,7,0,0,37,20,0,1,1],p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[148,,,,148,,,,148,,,,148,,,,148,,,,148,,,,148,,,,148],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,59,0,10,25,55,0,0,0,109,5,0,1,239,112,0,32,64,5,16,4],p:[,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148],f:[]}]},{i:[2,120,128,0,3,215,128,0,0,0,0,37,29,0,0,0,0,195,4,1,3,50,184,119,244,76,6,84,6],p:[,,3,3,3,3,,,3,3,,,3,3],c:[{n:[],f:[]},{n:[],f:[]},{n:[106,,,,,,106],f:[]}]},{i:[2,29,128,0,3,68,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[,,,,,,4,5,,,4,5],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[154,,,,,,,,,,,,,,,,155],f:[]},{n:[152,,,,,,,,,,,,,,,,154],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,216,158,158,158,0,0,0,0,51,2,1,2,58,239,0,32,88,1,157,2],p:[6,,6,,6,,6,,6,,6],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[148,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,148],f:[]}]},{i:[0,21,128,0,0,16,140,0,0,0,154,51,87,61,12,4,0,96,3,1,3,51,160,9,32,84,2,195,3],p:[,,,,,,,,7,,,,7],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[142],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,7,6,22,34,0,0,0,0,69,3,1,1,23,167,255,255,77,6,11,8],p:[,,8,,8,,9,10,,,9,10],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[118,,,,,,118,,,,118],f:[]},{n:[118,,,,,,118,,,,118,,,,,,119,,,,,,119,,,,119],f:[]},{n:[116,,,,,,116,,,,116,,,,,,118,,,,,,118,,,,118],f:[]}]}],rowLen:5513,patternLen:32,endPattern:13,numChannels:7},l=function(){var t,e,i,s,h,n=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},r=function(t,e,i){var s,h,n,r,l,c,u=o[t.i[0]],f=t.i[1],y=t.i[3]/32,d=o[t.i[4]],p=t.i[5],v=t.i[8]/32,x=t.i[9],m=t.i[10]*t.i[10]*4,w=t.i[11]*t.i[11]*4,g=t.i[12]*t.i[12]*4,b=1/g,k=-t.i[13]/16,M=t.i[14],S=i*2**(2-t.i[15]),E=new Int32Array(m+w+g),T=0,R=0;for(s=0,h=0;s<m+w+g;s++,h++)h>=0&&(h-=S,l=a(e+(15&(M=M>>8|(255&M)<<4))+t.i[2]-128),c=a(e+(15&M)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,s<m?n=s/m:s>=m+w&&(n=(1-(n=(s-m-w)*b))*3**(k*n)),r=u(T+=l*n**y)*f,r+=d(R+=c*n**v)*p,x&&(r+=(2*Math.random()-1)*x),E[s]=80*r*n|0;return E},o=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(n){t=n,e=n.endPattern,i=0,s=n.rowLen*n.patternLen*(e+1)*2,h=new Int32Array(s)},this.generate=function(){var a,l,c,u,f,y,d,p,v,x,m,w,g,b,k=new Int32Array(s),M=t.songData[i],S=t.rowLen,E=t.patternLen,T=0,R=0,A=!1,D=[];for(c=0;c<=e;++c)for(d=M.p[c],u=0;u<E;++u){var L=d?M.c[d-1].f[u]:0;L&&(M.i[L-1]=M.c[d-1].f[u+E]||0,L<17&&(D=[]));var H=o[M.i[16]],I=M.i[17]/512,W=2**(M.i[18]-9)/S,P=M.i[19],C=M.i[20],j=43.23529*M.i[21]*3.141592/44100,z=1-M.i[22]/255,B=1e-5*M.i[23],N=M.i[24]/32,O=M.i[25]/512,Y=6.283184*2**(M.i[26]-9)/S,G=M.i[27]/255,F=M.i[28]*S&-2;for(m=(c*E+u)*S,f=0;f<4;++f)if(y=d?M.c[d-1].n[u+f*E]:0){D[y]||(D[y]=r(M,y,S));var K=D[y];for(l=0,a=2*m;l<K.length;l++,a+=2)k[a]+=K[l]}for(l=0;l<S;l++)(x=k[p=2*(m+l)])||A?(w=j,P&&(w*=H(W*p)*I+.5),R+=(w=1.5*Math.sin(w))*(g=z*(x-R)-(T+=w*R)),x=3==C?R:1==C?g:T,B&&(x=(x*=B)<1?x>-1?n(.25*x):-1:1,x/=B),A=(x*=N)*x>1e-5,b=x*(1-(v=Math.sin(Y*p)*O+.5)),x*=v):b=0,p>=F&&(b+=k[p-F+1]*G,x+=k[p-F]*G),k[p]=0|b,k[p+1]=0|x,h[p]+=0|b,h[p+1]+=0|x}return++i/t.numChannels},this.createAudioBuffer=function(t){for(var e=t.createBuffer(2,s/2,44100),i=0;i<2;i++)for(var n=e.getChannelData(i),a=i;a<s;a+=2)n[a>>1]=h[a]/65536;return e},this.createWave=function(){var t=44+2*s-8,e=t-36,i=new Uint8Array(44+2*s);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var n=0,a=44;n<s;++n){var r=h[n];r=r<-32767?-32767:r>32767?32767:r,i[a++]=255&r,i[a++]=r>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),s=new Array(e),n=0;n<2*e;n+=1){var a=i+n;s[n]=t>0&&a<h.length?h[a]/32768:0}return s}},u;function y(){var t=new l;t.init(o),setInterval(function(){if(!n&&(n=t.generate()>=1)){var e=t.createWave();(h=document.createElement("audio")).src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),a=!0}},0)}function d(t,e,i,s,h,n,a,r=Ht){this.time=0,this.x=i,this.y=s,this.w=t,this.h=e,this.type=n,this.endPos=U(this),this.speed=7,this.angle=Math.atan2(this.endPos.y-this.y,this.endPos.x-this.x),this.remove=!1,this.alpha=1,this.colour="#"+["FF0000","B30000","7D0000","FF8080"][j(0,3)],this.no=1,"dust"==this.type&&(this.colour="#"+["4d1933","EDEDED"][j(0,1)],this.alpha=.1),this.rndCol=a,this.lastDir=r,this.update=function(t,e){if(this.time+=e,t.save(),t.translate(dt.cam.x,dt.cam.y),"circle"==this.type){let e=Math.atan2(this.y-this.endPos.y,this.x-this.endPos.x)+Math.PI+2*(Math.random()-.5);Math.hypot(this.endPos.x-this.x,this.endPos.y-this.y)>=10&&(this.x+=Math.cos(e)*this.speed-6*this.time,this.y+=Math.sin(e)*this.speed-6*this.time),this.alpha-=.01,this.w>1&&(this.w-=.75),t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586);let i=this.rndCol?C():this.colour;t.fillStyle=i,t.fill(),this.time>.6&&(this.remove=!0)}else"dust"==this.type&&(this.lastDir==Ht?this.x-=2:this.x+=2,this.y-=j(1,5)/10,t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586),t.fillStyle=this.colour,t.fill(),this.alpha>.1&&(this.alpha-=.01),this.w+=.1,this.time>.5&&(this.remove=!0));t.globalAlpha=1,t.restore()}}function p(t=0,e=0){this.x=t,this.y=e}var v=[];function x(t,e){for(m=u.createBuffer(1,96e3,48e3),gainNode=u.createGain(),b=m.getChannelData(0),i=96e3;i--;)b[i]=getSound(t,i);s=u.createBufferSource(),s.buffer=m,s.connect(gainNode),gainNode.connect(u.destination),gainNode.gain.value=e,s.start()}function w(e){if(t=((t,e)=>(e-t)/e),e>7e4)return null;t(e,7e4);return Math.sin(.001*e*Math.sin(.009*e)+Math.sin(e/100))}function g(t){if(t>1e4)return null;var e=(1e4-t)/1e4;return(128&Math.pow(t,1.055)?1:-1)*Math.pow(e,2)}function k(t){if(t>5e4)return null;var e=(5e4-t)/5e4;return(200&Math.pow(t,.9)?1:-1)*Math.pow(e,3)}function M(t){var e=1e4;if(t>e)return null;var i=(e-t)/e,s=Math.pow(i,2.1);return Math.pow(t,3)&(t<3333.3333333333335?16:99)?s:-s}function S(t){if(t>2e4)return null;var e=(2e4-t)/2e4;return Math.sin(.003*-t*Math.sin(.09*t+Math.sin(t/200))+Math.sin(t/100))*e*e}function E(t){if(t>1e4)return null;var e=(1e4-t)/1e4;return Math.sin(.01*t*Math.sin(.009*t+Math.sin(t/200))+Math.sin(t/100))*e*e}function T(e){if(e>2e3)return null;t=((t,e)=>(e-t)/e);var i=t(e,2e3);return 33&Math.pow(50*e,.7)?i:-i}function R(e){if(t=((t,e)=>(e-t)/e),e>2e4)return null;var i=t(e,2e4);return e*=.04,Math.sin(.03*-e*Math.sin(.09*e+Math.sin(e/200))+Math.sin(e/100))*i}function A(){var t=!0;this.cam=new p,this.ratio=1,this.tips=!0,this.time=0,this.ratio=Q>800?Q/800:Z/600,this.scale=2,this.cube=16,this.scaled=this.scale*this.cube,this.hero=new J(16,16,0,0,0,D.HERO,this.scale),this.introT=0,this.shake=0,this.shakeTime=0,this.reset=!1,this.wait=2,this.genLevel=function(t){this.levels=[];var e=new X(1,Q,Z,this.scale);e.reset(1,this.scaled),this.levels.push(e),this.level=this.levels[0],this.hero.e.curLevel=0,this.hero.e.x=this.level.startPos[0],this.hero.e.y=this.level.startPos[1]},this.genLevel(0),this.level.objs.push(this.hero.e);this.levels[this.hero.e.curLevel].cols;this.update=function(e,i,s=!1){this.time=i,t&&(t=!1,ctx.scale(this.ratio,this.ratio)),this.shake=yt?Math.cos(it):0,this.hero.setCurrentTile(this.scaled),s||(this.level.draw(this.hero,e),this.hero.update(ctx,e),mt.canvas.style.cursor="none"),this.cam.x=V(400-this.hero.e.x-20,this.cam.x,.8),this.cam.y=V(300-this.hero.e.y-80,this.cam.y,.8)}}getSound=function(t,e){var i;switch(t){case Jt:i=w(e);break;case Qt:i=M(e);break;case Zt:i=g(e);break;case $t:i=k(e);break;case _t:i=S(e);break;case te:i=E(e);break;case ee:i=T(e);break;case ie:i=R(e);break;default:return 1}return i};const D={AIR:0,GRASS:1,HERO:2,BRDE:3,WTR:4,SEA:5,SND:6,TREE:7,RCK:8},L={FOLLOW:0,SIMPLE:1};function H(t,e,i,s,h,n,a,r,o,l){this.id=t,this.up=W(r,o,colz,colz),s+=this.up,this.drop=I(r,o,colz,colz),this.e=new q(e,e,i,s,h,n,"",l,0,0),this.up>=0&&n==D.GRASS&&(this.e.sx=16,this.e.sy=16),this.column=r,this.row=o,this.active=!0,n==D.GRASS&&(this.e.y-=4),n==D.SND&&(this.e.y+=2),this.oscillationSpeed=.5,this.oscillationAmount=5,this.initialY=this.e.y,this.e.y=this.e.y+this.drop,this.update=function(t){if(this.e.y=V(this.e.y,this.initialY,.08),this.e.type==D.SEA){let t=.001*Date.now(),e=Math.sin(t*this.oscillationSpeed+this.column)*this.oscillationAmount;this.e.offsetY=0,this.e.y=this.initialY+e}this.e.update(t)},this.isTile=function(){return!0}}function I(t,e,i,s){const h=i/2,n=s/2,a=Math.min(i,s)/3,r=(t-h)*(t-h)+(e-n)*(e-n);return-(500*Math.exp(-r/(2*a*a)))}function W(t,e,i,s){const h=i/2,n=s/2,a=Math.min(i,s)/3;return Math.sqrt((t-h)*(t-h)+(e-n)*(e-n))<a?-12:0}function P(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}function C(){let t="#";for(var e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}function j(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function B(t){return new P(t.x,t.y,t.w,t.h)}function N(t,e,i,s,h,n,a,r){return t<h+a&&t+i>h&&e<n+r&&e+s>n}function O(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function Y(t,e){this.x=t,this.y=e,this.set=function(t,e){this.x=t,this.y=e}}function G(t,e,i,s,h,n,a,r,o,l,c=0){t.save(),t.globalAlpha=o,t.translate(a,r),c>0&&(t.translate(24,24),t.rotate(c*Math.PI/180),t.translate(-24,-24)),t.drawImage(e,i,s,h,n,h/2,n/2,h*l,n*l),t.restore()}function F(t,e,i,s,h,n,a,r,o){t.save(),t.globalAlpha=o,t.translate(e,i),t.fillStyle=r,t.fillRect(s,h,n,a),t.restore()}function K(){}function U(t){var e=j(0,360)*Math.PI/180,i=j(50,180),s=[-1,1][j(0,1)]*i;return{x:t.x+s*Math.cos(e),y:t.y+s*Math.sin(e)}}function V(t,e,i){return(1-i)*t+i*e}function X(t,e,i,s){ut=t,this.tiles=[],this.objs=[],this.active=!1,this.startPos=[0,260],this.cols=colz,this.rotate=!1;let h=0;function n(t,e){let i=t.e.type;t.e.type=e.e.type,e.e.type=i,t.e.setType(),e.e.setType()}this.draw=function(t,e,i){this.tiles.forEach(t=>t.update(e,i)),this.objs.sort((t,e)=>t.y-e.y),this.objs.forEach(t=>t.update(e)),this.rotate&&(!function(t){let e=colz;for(let i=0;i<e;i++)for(let s=i+1;s<e;s++){let h=t.level.tiles[i*e+s],a=t.level.tiles[s*e+i];n(h,a)}for(let i=0;i<e;i++)for(let s=0;s<e/2;s++){let h=t.level.tiles[i*e+s],a=t.level.tiles[i*e+(e-s-1)];n(h,a)}}(dt),this.rotate=!1)},this.reset=function(t,e){console.log("RESET"),this.tiles=[],this.dTiles=[],h=0;let i=j(2,5),n=0,a=colz,o=0;for(r=0;r<a;r++)for(c=0;c<this.cols;c++){let t=1;r<4||c<4||c>colz-4||r>colz-4?t=D.SEA:(r<6||c<6||c>colz-6||r>colz-6)&&j(0,100)>50?t=D.SEA:(r<8||c<8||c>colz-8||r>colz-8)&&j(0,100)>20?t=D.SND:j(0,100)>99&&n<i&&(t=D.WTR,n++),xx=16*(c-r),yy=8*(c+r);var l=new H(o,16,xx,yy,0,t,!1,c,r,s);this.tiles.push(l),o++}const u=[];var f,y,d,p,v;this.tiles.forEach((t,e)=>{(function(t){return t==D.WTR})(t.e.type)&&Array.from({length:j(3,8)},(t,e)=>e).forEach(e=>{Array.from({length:j(3,5)},(t,e)=>e).forEach(i=>{let s=(d=t.row+e,p=t.column+i,v=colz,d*v+p);s=s,y=this.tiles.length,s>=0&&s<y&&u.push(s)})})}),u.forEach(t=>{j(0,100)>20&&this.tiles[t].e.type!=D.WTR&&(this.tiles[t].e.type=D.WTR,this.tiles[t].e.setType(),this.tiles[t].initialY+=6)}),maxTrees=10,trees=0,maxRocks=5,rocks=0,this.tiles.forEach(t=>{t.e.type==D.GRASS&&j(0,100)>98&&trees<maxTrees?(obj=new q(16,23,t.e.x,t.e.y-t.drop-10-30,0,D.TREE,"",s,!1,0),obj.parent=t,this.objs.push(obj),trees++):t.e.type==D.GRASS&&j(0,100)>98&&rocks<maxRocks&&(obj=new q(16,16,t.e.x,t.e.y-t.drop-10,0,D.ROCK,"",s,!1,0),obj.parent=t,this.objs.push(obj),rocks++)})}}function q(t,e,i,h,n,a,r,o,l=!1,c=0){this.scale=o,this.type=a,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.mhWScld=t/-2*o,this.mhHScld=e/-2*o,this.hWidth=t/2,this.hHeight=e/2,this.cenX=i-this.mhWScld,this.cenY=h-this.mhHScld,this.angle=n,this.x=i,this.y=h,this.active=!0,this.colour=r,this.image=ft,this.animated=!1,this.alpha=1,this.currentTile=0,this.colArr=[],this.isSolid=!1,this.isButton=l,this.time=0,this.maxHP=c,this.hp=this.maxHP,this.flip=!1,this.idle=0,this.chk=!1,this.offsetY=0,this.parent=null,this.sx=0,this.sy=0,this.setHitbox=function(){this.hb=new P(0,0,0,0),this.sensor=new P(0,0,0,0),this.isButton&&(this.hb.w=2*this.width,this.hb.h=2*this.height)},this.setHitbox(),this.updateHitbox=function(){this.isButton?(this.hb.x=this.x-this.width,this.hb.y=this.y-this.height):(this.hb.x=this.x+this.scale/2,this.hb.y=this.y+this.scale/2,this.hb.w=this.width*this.scale-this.scale,this.hb.h=this.height*this.scale-this.scale,this.sensor.x=this.x-5,this.sensor.y=this.y-5,this.sensor.w=this.width*this.scale+10,this.sensor.h=this.height*this.scale+10)},this.update=function(i){if(this.idle+=i,this.updateHitbox(),this.active){if(ctx.save(),ctx.translate(this.x,this.y),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,e=this.height,dt.shakeTime>0&&(dt.shakeTime-=i/1e3,ctx.translate(dt.shake,dt.shake)),ctx.translate(dt.cam.x,dt.cam.y),null==this.image)ctx.fillStyle=this.colour,ctx.fillRect(.5*mhw*s,.5*mhh*s,.5*t*s,.5*e*s);else{if(this.flip?(ctx.scale(-1,1),ctx.translate(-t*s-t,0)):ctx.scale(1,1),f=0,z=0,this.angle>0){let t=24;ctx.translate(t,t),ctx.rotate(this.angle*Math.PI/180),ctx.translate(-t,-t)}ctx.drawImage(img,this.sx,this.sy,t,e,hw+z,hh+f,t*s,e*s)}ctx.restore()}this.cenX=this.x-this.mhWScld,this.cenY=this.y-this.mhHScld},this.isHero=function(){return this.type==D.HERO},this.isTile=function(){return!1},this.setT=function(t){this.type=t,this.setType()},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.isSolid=!1,this.type){case D.HERO:this.isSolid=!0,this.sx=0,this.sy=0;break;case D.GRASS:this.sx=16;break;case D.BRDE:this.sx=32;break;case D.WTR:case D.SEA:this.sx=48;break;case D.AIR:this.sx=144;break;case D.SND:this.sy=16;break;case D.TREE:this.isSolid=!0,this.sx=80;break;case D.ROCK:this.isSolid=!0,this.sx=64}},this.setType()}function J(t,i,s,h,n,a,r){this.e=new q(t,i,s,h,n,a,"",r,!1,100),this.active=!0,this.hp=2,this.particles=[];let o=null,l=null,c=0,u=0,f=(this.e.x,this.e.y,0),y=0,d=0,p=0,v=!1;this.deaths=0,this.done=!1,this.changeLevel=!1,this.moved=!1,this.update=function(t,e){this.time+=e,c+=e,this.moved=!1,this.active&&(Mt()||St()||Et()||Tt()?(f+=e,u=u>3?3:u+=.5):(u=u>0?u-=.5:0,f=0),Et()&&(this.e.y-=this.gMove(0,1),this.moved=!0),Tt()&&(this.e.y+=this.gMove(0,-1),this.moved=!0),Mt()&&(this.e.x-=this.gMove(-1,0),this.e.flip=!0,this.moved=!0),St()&&(this.e.x+=this.gMove(1,0),this.e.flip=!1,this.moved=!0)),(Et()||Rt()||Dt()||St()||Mt())&&(c=0);for(let i=0;i<=this.particles.length-1;i++)this.particles[i].update(t,e);f>.35&&this.addDust(),d=this.e.x-this.e.mhWScld,p=this.e.y-this.e.mhHScld},this.reset=function(){this.done=!1,this.particles=[],this.hp=2;let t=dt.levels[this.e.curLevel];this.e.x=t.startPos[0],this.e.y=t.startPos[1]},this.kill=function(){this.active&&(this.deaths++,dt.shakeTime=.15,x(te,1),this.hp--,this.active=!1,y=.5,u=0,this.e.sy=16,0==this.hp&&this.hp++)},this.setCurrentTile=function(t){if(this.moved){l=o;const e=this.e.x/t,i=(this.e.y+1.5*this.e.height)/t*2,s=i-e,h=e+i;heroRow=Math.floor(s),heroCol=Math.floor(h),heroTileIndex=heroCol+dt.levels[this.e.curLevel].cols*heroRow,(o=dt.level.tiles[heroTileIndex])&&l&&o.id!==l.id&&l.up!==o.up&&(this.e.y+=.5*(o.up-l.up))}},this.addDust=function(t=!1){f=0},this.jump=function(){},this.gMove=function(t,i,s=!1,h=!1){this.e.idle=0;var n=u;rec=B(this.e.hb),rec.x+=t*n,rec.y+=i*n,canMove=!0,amount=n;for(var a=n;a>0;a--){canMove=!0;for(var r=0;r<this.e.colArr.length;r++)if(obj=this.e.colArr[r],null!=obj&&null!=obj.entity){if(e=obj.entity,obj.isTile()&&O(e.hb,rec)&&obj.active&&e.isSolid){canMove=!1;break}}else this.e.y>500&&(v=!0);if(canMove)break;amount--,rec.x-=t,rec.y-=i}return amount}}colz=60;let Q=window.innerWidth,Z=window.innerHeight,$=!1,_=0,tt=Date.now(),et=Date.now(),it=0,st=0,ht=new Y(0,0),nt=new Y(0,0),at=!1,rt=!1,ot=!1,lt="990099",ct=!1,ut=1,ft=new Image;ft.src="atlas.png";let yt=!0,dt=new A,pt=!1,vt=!0,xt=!1;function startGame(){mt.start()}y();let mt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=Q,this.canvas.height=Z,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(wt,20),window.addEventListener("keydown",function(t){pt=!0,t.preventDefault(),mt.keys=mt.keys||[],mt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){mt.keys[t.keyCode]="keydown"==t.type,t.keyCode==Xt&&(ot=!0),t.keyCode==Bt&&(xt=!xt),t.keyCode==qt&&(dt.tips=!dt.tips)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}};function wt(){if(rt&&(it=0,rt=!1,ct=!1,ut=0,pt=!1,$=!1,dt.genLevel(ut)),pt&&(null!=dt.hero&&(dt.hero.e.active=!0),$=!0,null==u&&(u=new AudioContext)),tt=et,et=Date.now(),it+=_=et-tt,$){mt.clear(),dt.update(_,it,!1);let t="15px Verdana";kt(ctx,1,t,"WHITE","[M] Music: "+!xt,650,20),kt(ctx,1,t,"WHITE","[T] Tips: "+dt.tips,650,40),kt(ctx,1,t,"WHITE","[R] Reset Level",650,60),kt(ctx,1,t,"WHITE","Lives: "+dt.hero.hp,10,40),kt(ctx,1,t,"RED","Deaths: "+dt.hero.deaths,10,60),kt(ctx,1,t,"WHITE","Level: "+(dt.hero.e.curLevel+1),10,20);dt.hero.e.curLevel;xt&&(h.pause(),vt=!0),vt&&n&&!xt&&(h.play(),h.loop=!0,vt=!1)}else{mt.clear(),ctx=mt.context,dt.update(_,it,!0),ctx.save(),gt(ctx,.1,"#"+lt,0,0,800,600),kt(ctx,1,"20px Verdana","WHITE","Main Screen",50,40),ctx.restore(),ctx.save()}}function gt(t,e,i,s,h,n,a){t.globalAlpha=e,t.fillStyle=i,t.fillRect(s,h,n,a)}function bt(t,e,i,s,h,n,a){var r=eval('"\\u'+h+'"');t.globalAlpha=e,t.font=i,t.fillStyle=s,t.fillText(r,n,a)}function kt(t,e,i,s,h,n,a){t.globalAlpha=e,t.font=i,t.fillStyle=s,t.fillText(h,n,a)}function Mt(){return mt.keys&&(mt.keys[Lt]||mt.keys[Ct])}function St(){return mt.keys&&(mt.keys[Ht]||mt.keys[zt])}function Et(){return mt.keys&&(mt.keys[It]||mt.keys[Pt])}function Tt(){return mt.keys&&(mt.keys[Wt]||mt.keys[jt])}function Rt(){return mt.keys&&mt.keys[Yt]}function At(){return mt.keys&&mt.keys[Bt]}function Dt(){return mt.keys&&(mt.keys[Ft]||mt.keys[Gt])}var Lt=37,Ht=39,It=38,Wt=40,Pt=87,Ct=65,jt=83,zt=68,Bt=77,Nt=0,Ot=2,Yt=32,Gt=69,Ft=49,Kt=50,Ut=51,Vt=52,Xt=82,qt=84,Jt=0,Qt=1,Zt=2,$t=3,_t=4,te=5,ee=6,ie=7;