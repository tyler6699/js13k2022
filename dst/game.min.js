var h,n=!1,a=!1,l={songData:[{i:[0,120,116,79,0,159,116,0,83,0,0,6,69,52,0,0,0,0,0,0,2,7,0,0,37,20,0,1,1],p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[148,,,,148,,,,148,,,,148,,,,148,,,,148,,,,148,,,,148],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,59,0,10,25,55,0,0,0,109,5,0,1,239,112,0,32,64,5,16,4],p:[,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148,,148,148,148],f:[]}]},{i:[2,120,128,0,3,215,128,0,0,0,0,37,29,0,0,0,0,195,4,1,3,50,184,119,244,76,6,84,6],p:[,,3,3,3,3,,,3,3,,,3,3],c:[{n:[],f:[]},{n:[],f:[]},{n:[106,,,,,,106],f:[]}]},{i:[2,29,128,0,3,68,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[,,,,,,4,5,,,4,5],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[154,,,,,,,,,,,,,,,,155],f:[]},{n:[152,,,,,,,,,,,,,,,,154],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,216,158,158,158,0,0,0,0,51,2,1,2,58,239,0,32,88,1,157,2],p:[6,,6,,6,,6,,6,,6],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[148,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,148],f:[]}]},{i:[0,21,128,0,0,16,140,0,0,0,154,51,87,61,12,4,0,96,3,1,3,51,160,9,32,84,2,195,3],p:[,,,,,,,,7,,,,7],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[142],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,7,6,22,34,0,0,0,0,69,3,1,1,23,167,255,255,77,6,11,8],p:[,,8,,8,,9,10,,,9,10],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[118,,,,,,118,,,,118],f:[]},{n:[118,,,,,,118,,,,118,,,,,,119,,,,,,119,,,,119],f:[]},{n:[116,,,,,,116,,,,116,,,,,,118,,,,,,118,,,,118],f:[]}]}],rowLen:5513,patternLen:32,endPattern:13,numChannels:7},o=function(){var t,e,i,s,h,n=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},r=function(t,e,i){var s,h,n,r,o,c,u=l[t.i[0]],f=t.i[1],y=t.i[3]/32,p=l[t.i[4]],d=t.i[5],v=t.i[8]/32,x=t.i[9],g=t.i[10]*t.i[10]*4,m=t.i[11]*t.i[11]*4,w=t.i[12]*t.i[12]*4,b=1/w,k=-t.i[13]/16,T=t.i[14],E=i*2**(2-t.i[15]),L=new Int32Array(g+m+w),I=0,M=0;for(s=0,h=0;s<g+m+w;s++,h++)h>=0&&(h-=E,o=a(e+(15&(T=T>>8|(255&T)<<4))+t.i[2]-128),c=a(e+(15&T)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,s<g?n=s/g:s>=g+m&&(n=(1-(n=(s-g-m)*b))*3**(k*n)),r=u(I+=o*n**y)*f,r+=p(M+=c*n**v)*d,x&&(r+=(2*Math.random()-1)*x),L[s]=80*r*n|0;return L},l=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(n){t=n,e=n.endPattern,i=0,s=n.rowLen*n.patternLen*(e+1)*2,h=new Int32Array(s)},this.generate=function(){var a,o,c,u,f,y,p,d,v,x,g,m,w,b,k=new Int32Array(s),T=t.songData[i],E=t.rowLen,L=t.patternLen,I=0,M=0,S=!1,H=[];for(c=0;c<=e;++c)for(p=T.p[c],u=0;u<L;++u){var P=p?T.c[p-1].f[u]:0;P&&(T.i[P-1]=T.c[p-1].f[u+L]||0,P<17&&(H=[]));var A=l[T.i[16]],R=T.i[17]/512,W=2**(T.i[18]-9)/E,D=T.i[19],O=T.i[20],C=43.23529*T.i[21]*3.141592/44100,j=1-T.i[22]/255,B=1e-5*T.i[23],K=T.i[24]/32,N=T.i[25]/512,F=6.283184*2**(T.i[26]-9)/E,J=T.i[27]/255,U=T.i[28]*E&-2;for(g=(c*L+u)*E,f=0;f<4;++f)if(y=p?T.c[p-1].n[u+f*L]:0){H[y]||(H[y]=r(T,y,E));var Y=H[y];for(o=0,a=2*g;o<Y.length;o++,a+=2)k[a]+=Y[o]}for(o=0;o<E;o++)(x=k[d=2*(g+o)])||S?(m=C,D&&(m*=A(W*d)*R+.5),M+=(m=1.5*Math.sin(m))*(w=j*(x-M)-(I+=m*M)),x=3==O?M:1==O?w:I,B&&(x=(x*=B)<1?x>-1?n(.25*x):-1:1,x/=B),S=(x*=K)*x>1e-5,b=x*(1-(v=Math.sin(F*d)*N+.5)),x*=v):b=0,d>=U&&(b+=k[d-U+1]*J,x+=k[d-U]*J),k[d]=0|b,k[d+1]=0|x,h[d]+=0|b,h[d+1]+=0|x}return++i/t.numChannels},this.createAudioBuffer=function(t){for(var e=t.createBuffer(2,s/2,44100),i=0;i<2;i++)for(var n=e.getChannelData(i),a=i;a<s;a+=2)n[a>>1]=h[a]/65536;return e},this.createWave=function(){var t=44+2*s-8,e=t-36,i=new Uint8Array(44+2*s);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var n=0,a=44;n<s;++n){var r=h[n];r=r<-32767?-32767:r>32767?32767:r,i[a++]=255&r,i[a++]=r>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),s=new Array(e),n=0;n<2*e;n+=1){var a=i+n;s[n]=t>0&&a<h.length?h[a]/32768:0}return s}},u;function y(){var t=new o;t.init(l),setInterval(function(){if(!n&&(n=t.generate()>=1)){var e=t.createWave();(h=document.createElement("audio")).src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),a=!0}},0)}function p(t,e,i,s,h,n,a,r=Bt){this.time=0,this.x=i,this.y=s,this.w=t,this.h=e,this.type=n,this.endPos=Y(this),this.speed=7,this.angle=Math.atan2(this.endPos.y-this.y,this.endPos.x-this.x),this.remove=!1,this.alpha=1,this.colour="#"+["FF0000","B30000","7D0000","FF8080"][C(0,3)],this.no=1,"dust"==this.type&&(this.colour="#"+["4d1933","EDEDED"][C(0,1)],this.alpha=.1),this.rndCol=a,this.lastDir=r,this.update=function(t,e){if(this.time+=e,t.save(),t.translate(mt.cam.x,mt.cam.y),"circle"==this.type){let e=Math.atan2(this.y-this.endPos.y,this.x-this.endPos.x)+Math.PI+2*(Math.random()-.5);Math.hypot(this.endPos.x-this.x,this.endPos.y-this.y)>=10&&(this.x+=Math.cos(e)*this.speed-6*this.time,this.y+=Math.sin(e)*this.speed-6*this.time),this.alpha-=.01,this.w>1&&(this.w-=.75),t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586);let i=this.rndCol?W():this.colour;t.fillStyle=i,t.fill(),this.time>.6&&(this.remove=!0)}else if("dust"==this.type)this.lastDir==Bt?this.x-=2:this.x+=2,this.y-=C(1,5)/10,t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586),t.fillStyle=this.colour,t.fill(),this.alpha>.1&&(this.alpha-=.01),this.w+=.1,this.time>.5&&(this.remove=!0);else if("bld"==this.type){t.beginPath(),t.globalAlpha=this.alpha;for(let e=0;e<=this.no;e++)t.arc(this.x,this.y+e,this.w,0,6.283185307179586),t.fillStyle=this.colour,t.fill();C(1,10)>8&&this.no++,this.alpha-=.01,(this.time>2.5||this.alpha<=0)&&(this.remove=!0)}t.globalAlpha=1,t.restore()}}function d(t=0,e=0){this.x=t,this.y=e}var v=[];function x(t,e){for(m=u.createBuffer(1,96e3,48e3),gainNode=u.createGain(),b=m.getChannelData(0),i=96e3;i--;)b[i]=getSound(t,i);s=u.createBufferSource(),s.buffer=m,s.connect(gainNode),gainNode.connect(u.destination),gainNode.gain.value=e,s.start()}function g(e){if(t=((t,e)=>(e-t)/e),e>7e4)return null;t(e,7e4);return Math.sin(.001*e*Math.sin(.009*e)+Math.sin(e/100))}function w(t){if(t>1e4)return null;var e=(1e4-t)/1e4;return(128&Math.pow(t,1.055)?1:-1)*Math.pow(e,2)}function k(t){if(t>5e4)return null;var e=(5e4-t)/5e4;return(200&Math.pow(t,.9)?1:-1)*Math.pow(e,3)}function T(t){var e=1e4;if(t>e)return null;var i=(e-t)/e,s=Math.pow(i,2.1);return Math.pow(t,3)&(t<3333.3333333333335?16:99)?s:-s}function E(t){if(t>2e4)return null;var e=(2e4-t)/2e4;return Math.sin(.003*-t*Math.sin(.09*t+Math.sin(t/200))+Math.sin(t/100))*e*e}function L(t){if(t>1e4)return null;var e=(1e4-t)/1e4;return Math.sin(.01*t*Math.sin(.009*t+Math.sin(t/200))+Math.sin(t/100))*e*e}function I(e){if(e>2e3)return null;t=((t,e)=>(e-t)/e);var i=t(e,2e3);return 33&Math.pow(50*e,.7)?i:-i}function M(e){if(t=((t,e)=>(e-t)/e),e>2e4)return null;var i=t(e,2e4);return e*=.04,Math.sin(.03*-e*Math.sin(.09*e+Math.sin(e/200))+Math.sin(e/100))*i}function S(){var t=!0;this.cam=new d,this.ratio=1,this.tips=!0,this.ratio=Q>800?Q/800:Z/600,this.scale=2,this.cube=16,this.scaled=this.scale*this.cube,this.hero=new q(16,16,40*this.scale,100*this.scale,0,H.HERO,this.scale),this.introT=0,this.shake=0,this.shakeTime=0,this.reset=!1,this.wait=2,this.rawlvls=[],this.rawlvls=[],this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,1],[1,14,0,0,0,0,0,0,0,0,0,0,0,8,0,10,0,0,0,0,0,9,0,1],[1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,14,1],[0,0,11,12,0,14,6,0,0,0,0,0,5,14,0,11,12,0,0,0,1,1,1,1],[0,0,11,12,0,14,6,3,3,3,3,3,5,14,0,11,12,0,0,0,0,11,12,0],[0,0,11,12,0,1,1,1,1,1,1,1,1,1,0,11,12,0,0,0,0,15,16,0],[0,0,15,16,0,0,0,0,0,0,0,0,0,0,0,15,16,0,0,0,0,0,0,0]]),this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,14,2,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0],[0,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,14,0,0,0,0,0],[0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0],[0,0,11,12,0,0,0,0,0,0,0,0,0,0,0,0,11,12,0,0,0,0,0,0],[0,0,11,12,0,3,3,3,3,3,3,3,3,3,3,0,11,12,0,0,0,0,0,0],[0,0,15,16,0,14,14,14,14,14,14,14,14,14,14,0,15,16,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,5,1,1,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,2,0,0,0,0,0,0,5,1,14,14,14,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,5,1,14,14,14,14,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,14,14,0,0,0,0,0,0,0,0,0,0],[0,7,14,14,14,14,7,0,0,0,0,0,0,14,0,0,0,0,0,0,0,0,0,0],[0,0,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,13,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,9,0,13,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[1,6,0,0,0,1,1,14,0,0,0,0,8,0,0,0,0,0,0,0,0],[1,6,0,0,0,1,0,0,0,0,5,1,1,1,1,0,0,0,0,0,0],[1,6,0,0,0,10,0,2,0,0,5,14,14,14,1,0,0,0,0,0,0],[1,6,0,0,0,10,0,0,0,0,5,14,14,14,14,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,14,14,0,0,0,0,0,0,0],[0,7,14,14,14,14,7,7,7,7,7,7,0,14,0,0,0,0,0,0,0],[0,0,14,14,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,14,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,13,14,14,14,14,14,14,14,14,14,14,13,0,0,0,0,0],[0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,17,17,17,17,17,17,17,1,1,1,1,1,0,0],[0,0,0,0,11,12,0,0,0,0,0,0,0,0,0,11,12,0,0,0,0],[0,0,0,0,11,12,0,0,0,0,0,0,0,0,0,11,12,0,0,0,0],[0,0,0,0,15,16,0,0,0,0,0,0,0,0,0,15,16,0,0,0,0]]),this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,14,14,0,0,0,0,0,0,0,0,5,1,1,1,1,1,1,1,1,0,0],[0,0,0,11,12,0,0,0,0,0,0,0,0,5,17,14,14,10,14,14,10,17,0,0],[0,0,0,11,12,0,5,1,0,0,0,0,0,5,17,14,10,10,14,14,14,17,0,0],[0,2,0,11,12,0,5,1,14,0,19,0,0,5,17,14,14,14,10,0,0,0,0,0],[0,0,0,11,12,0,5,1,1,1,1,1,1,1,17,10,14,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,0,0,0,13,0],[0,0,0,0,0,0,0,14,14,14,14,14,14,0,0,0,0,0,0,0,9,0,0,0],[0,0,1,1,1,1,14,14,14,14,14,14,14,14,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,1,0,4,0,0,4,0,0,0,0,0,0,0,1,1,1,0,0],[0,1,0,0,0,5,1,0,0,0,0,0,0,0,0,0,0,0,1,14,14,14,0,0],[0,1,8,0,0,5,1,0,0,0,0,0,0,0,0,0,0,1,1,7,7,7,0,0],[0,1,1,0,0,5,1,0,0,0,0,0,0,0,0,5,1,14,7,0,0,0,0,0],[0,1,2,0,0,0,10,0,0,0,0,0,0,0,0,5,1,1,0,0,0,0,0,0],[0,1,0,0,0,0,10,0,0,0,0,0,0,0,0,14,1,14,0,0,0,0,0,0],[0,1,1,1,1,1,1,17,13,13,13,13,17,17,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.rawlvls.push([[0,0,0,0,0,0,0,1,1,1,1,1,14,14,0,0,0,0,0,0],[0,2,0,0,0,0,0,10,0,0,0,1,14,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,10,0,0,0,1,0,0,0,0,0,0,0,0],[1,1,1,1,17,17,17,1,17,17,17,1,0,0,0,0,0,0,0,0],[14,14,14,1,14,0,14,1,14,0,0,0,0,0,0,0,0,0,0,0],[0,0,14,1,0,0,14,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,9,0],[0,0,0,1,14,8,0,1,0,0,0,13,0,13,0,0,0,0,0,0],[0,0,0,1,3,1,3,1,0,17,0,0,17,0,0,17,0,1,1,1],[0,0,0,1,1,1,1,1,14,14,14,14,14,14,14,14,14,14,14,14]]),this.rawlvls.push([[0,0,0,0,0,0,0,0,17,17,17,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,4,4,3,3,3,1,0,8,0,0,3,0,0,0,13],[1,1,1,1,1,0,0,0,0,0,0,14,14,14,14,17,1,1,1,1,6,0,0,0],[1,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,6,0,0,0],[1,0,9,0,10,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,0],[1,1,1,1,1,1,1,1,17,17,17,1,3,3,3,3,3,3,3,3,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,14,14,14,14,14,14,14,14,14,14,0,0,0]]),this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,13,0,0,0,0,0,0,5,1,1,1,0,0,0,0,19,0,0,0,0,0,0,0,0,10,19,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,5,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,17,17,17,17,1,0,0,0,9,0],[0,0,0,1,0,0,19,0,0,0,0,14,14,14,14,14,14,14,14,1,0,0,0,0,0,0,0,1,0,1,0,13,0,0,1,0,0,5,1,1],[0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,14,14,1,0,0,0,0,0,0,0,1,0,1,17,17,17,17,1,19,0,0,5,1],[0,0,0,0,14,7,7,4,14,17,17,0,0,0,0,0,0,0,14,1,0,13,0,13,0,13,0,1,0,1,0,0,13,0,1,1,0,0,5,1],[0,0,0,0,0,0,0,0,0,13,13,0,17,17,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,17,17,17,17,1,0,0,0,5,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,13,0,0,1,0,0,0,0,0],[0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,17,17,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,1,19,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,8,0,0,0,1,0,14,1,17,17,1,14,1,1,0,0,0],[0,1,1,1,1,0,13,17,17,13,0,1,1,1,1,0,0,0,0,1,3,3,3,1,3,3,3,1,0,0,0,0,0,0,0,0,0,0,0,1],[0,0,11,12,0,0,0,0,0,0,0,0,11,11,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,15,16,0,0,0,0,0,0,0,0,15,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,3,3,17,17,3,3]]),this.rawlvls.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,13,0,0,0,0,0,0,0,0,0,0,13,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,14,0,0,0,0,0,0,0,19,0,0,0],[0,0,14,14,0,0,2,0,0,0,0,14,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,7,7,11,12,0,0,0,0,11,12,7,7,0,0],[0,0,0,11,12,0,0,0,0,11,12,0,0,0,0],[0,0,0,15,16,0,0,0,0,15,16,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]),this.genLevel=function(t){this.levels=[];let e=[130,130,130];for(i=0;i<this.rawlvls.length;i++){var s=new G(i+1,Q,Z,i,this.scale,e[i],this.rawlvls[i]);s.reset(i,this.scaled),this.levels.push(s)}this.level=this.levels[0],this.hero.e.curLevel=0,this.hero.e.x=this.level.startPos[0],this.hero.e.y=this.level.startPos[1]},this.genLevel(0);var e=this.levels[this.hero.e.curLevel].cols;this.surTiles=[-1,1,e-1,e,e+1,-e-1,-e,1-e],this.update=function(e,i,s=!1){if(t&&(t=!1,ctx.scale(this.ratio,this.ratio)),this.shake=gt?Math.cos(it):0,this.hero.setCurrentTile(this.scaled),this.level.draw(this.hero,e),!s){if(this.hero.update(ctx,e),Lt.canvas.style.cursor="none",ft&&(ft=!1,this.levels[this.hero.e.curLevel].reset(),this.hero.reset()),this.hero.doneTime<=0&&this.hero.changeLevel){this.hero.e.curLevel+=1,this.level=this.levels[this.hero.e.curLevel],this.hero.changeLevel=!1,this.hero.e.curLevel<10?O("Level "+(this.hero.e.curLevel+1)):O("Thank you for playing!");var h=this.levels[this.hero.e.curLevel].cols;this.surTiles=[-1,1,h-1,h,h+1,-h-1,-h,1-h],this.hero.reset()}this.cam.x=V(400-this.hero.e.x-20,this.cam.x,.8),this.cam.y=V(300-this.hero.e.y-80,this.cam.y,.8)}}}getSound=function(t,e){var i;switch(t){case ie:i=g(e);break;case se:i=T(e);break;case he:i=w(e);break;case ne:i=k(e);break;case ae:i=E(e);break;case re:i=L(e);break;case le:i=I(e);break;case oe:i=M(e);break;default:return 1}return i};const H={AIR:0,BLOCK:1,HERO:2,SPIKE:3,DROPY:4,LSPIKE:5,RSPIKE:6,TSPIKE:7,BUTTON:8,PORTAL:9,DOOR:10,PILL:11,PILR:12,SPIN:13,WALL:14,PILRE:15,PILLE:16,FALL:17,BRICK:18,CHK:19},P={FOLLOW:0,SIMPLE:1};function A(t,e,i,s,h,n,a,r,l,o){this.entity=new X(t,t,e,i,s,h,"",l,0,0),this.column=a,this.row=r,this.active=!0,this.trigger=o,this.e=this.entity,this.update=function(t){this.entity.update(t),this.e.falls&&this.e.fall&&this.e.active&&(this.e.fallTime-=t,this.e.fallTime<=0&&(this.e.y+=5,this.e.fallTime<-1&&(this.e.active=!1)))},this.change=function(){this.entity.type>=Object.values(H).length&&(this.entity.type=0),this.entity.setType()},this.isTile=function(){return!0}}function R(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}function W(){let t="#";for(var e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}let D=speechSynthesis.getVoices();function O(t){let e=new SpeechSynthesisUtterance;e.text=t,e.voice=speechSynthesis.getVoices().filter(function(t){return"Google UK English Female"==t.name})[0],speechSynthesis.speak(e)}function C(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function j(t){return new R(t.x,t.y,t.w,t.h)}function B(t,e,i,s,h,n,a,r){return t<h+a&&t+i>h&&e<n+r&&e+s>n}function K(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function N(t,e){this.x=t,this.y=e,this.set=function(t,e){this.x=t,this.y=e}}function F(t,e,i,s,h,n,a,r,l,o,c=0){t.save(),t.globalAlpha=l,t.translate(a,r),c>0&&(t.translate(24,24),t.rotate(c*Math.PI/180),t.translate(-24,-24)),t.drawImage(e,i,s,h,n,h/2,n/2,h*o,n*o),t.restore()}function J(t,e,i,s,h,n,a,r,l){t.save(),t.globalAlpha=l,t.translate(e,i),t.fillStyle=r,t.fillRect(s,h,n,a),t.restore()}function U(){}function Y(t){var e=C(0,360)*Math.PI/180,i=C(50,180),s=[-1,1][C(0,1)]*i;return{x:t.x+s*Math.cos(e),y:t.y+s*Math.sin(e)}}function V(t,e,i){return(1-i)*t+i*e}function G(t,e,i,s,h,n,a){vt=t,this.tiles=[],this.triggers=[],this.breakTiles=[],this.mvTiles=[],this.active=!1,this.roomNo=s,this.opendoors=!1,this.startPos=[0,0],this.doorDrop=n;let l=13;this.cols=24;let o=0;this.draw=function(t,e){this.tiles.forEach(t=>t.update(e)),this.opendoors&&this.mvTiles.forEach(t=>{t.entity.isSolid=!1,o<this.doorDrop?(t.entity.y+=2,o+=1):t.entity.active&&(mt.shakeTime=.1,t.entity.active=!1)}),this.triggers.forEach((e,i)=>{if(!e.trigger)return;e.entity.x,e.entity.hWidth;if(e.entity.type==H.DROPY){if(e.entity.trapactive)e.entity.y+=15;else{let i=t.e.x,s=t.e.x+t.e.width*h,n=e.entity.x,a=e.entity.x+e.entity.width*h;(i>n&&i<a||s>n&&s<a)&&t.e.y-t.e.height>e.entity.y&&(e.entity.trapactive=!0)}K(t.e.hb,e.entity.hb)?(t.bloodSplatter(!1,t.e.x,t.e.y),t.kill(),e.trigger=!1,e.entity.active=!1,e.entity.kills=!1):e.entity.y>1e3&&(e.trigger=!1,e.entity.active=!1)}})},this.reset=function(t,e){this.tiles=[],this.dTiles=[],this.mvTiles=[],this.opendoors=!1,o=0;let i=!1;for(l=a.length,this.cols=a[0].length,r=0;r<l;r++)for(c=0;c<this.cols;c++){let t=a[r][c];i=!1,ts=16*h,xx=c*ts,yy=r*ts;t==H.DROPY&&(i=!0),t==H.HERO&&(t=H.AIR,this.startPos=[xx,yy]),t==H.AIR&&C(0,100)>95&&(t=H.BRICK);var s=new A(16,xx,yy,0,t,!1,c,r,h,i);this.tiles.push(s),1==s.trigger&&this.triggers.push(s),t==H.DOOR&&this.mvTiles.push(s)}}}function X(t,e,i,h,n,a,r,l,o=!1,c=0){this.scale=l,this.type=a,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.mhWScaled=t/-2*l,this.mhHScaled=e/-2*l,this.hWidth=t/2,this.hHeight=e/2,this.cenX=i-this.mhWScaled,this.cenY=h-this.mhHScaled,this.angle=n,this.x=i,this.y=h,this.active=!0,this.colour=r,this.image=xt,this.animated=!1,this.spin=!1,this.alpha=1,this.currentTile=0,this.colArr=[],this.isSolid=!1,this.isButton=o,this.time=0,this.maxHP=c,this.hp=this.maxHP,this.breaks=!1,this.flip=!1,this.idle=0,this.pressed=!1,this.kills=!1,this.trapactive=!1,this.falls=!1,this.fallTime=0,this.fall=!1,this.chk=!1,this.sx=0,this.sy=0,this.setHitbox=function(){this.hb=new R(0,0,0,0),this.sensor=new R(0,0,0,0),this.isButton&&(this.hb.w=2*this.width,this.hb.h=2*this.height)},this.setHitbox(),this.updateHitbox=function(){this.isButton?(this.hb.x=this.x-this.width,this.hb.y=this.y-this.height):(this.hb.x=this.x+this.scale/2,this.hb.y=this.y+this.scale/2,this.hb.w=this.width*this.scale-this.scale,this.hb.h=this.height*this.scale-this.scale,this.sensor.x=this.x-5,this.sensor.y=this.y-5,this.sensor.w=this.width*this.scale+10,this.sensor.h=this.height*this.scale+10)},this.update=function(i){if(this.idle+=i,this.updateHitbox(),this.active){if(ctx.save(),ctx.translate(this.x,this.y),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,e=this.height,mt.shakeTime>0&&(mt.shakeTime-=i/1e3,ctx.translate(mt.shake,mt.shake)),ctx.translate(mt.cam.x,mt.cam.y),null==this.image)ctx.fillStyle=this.colour,ctx.fillRect(.5*mhw*s,.5*mhh*s,.5*t*s,.5*e*s);else{if(this.flip?(ctx.scale(-1,1),ctx.translate(-t*s-t,0)):ctx.scale(1,1),f=0,z=0,this.angle>0||this.spin){let t=24;ctx.translate(t,t),this.angle=this.spin?this.angle+=8+C(0,5):this.angle,ctx.rotate(this.angle*Math.PI/180),ctx.translate(-t,-t)}ctx.drawImage(img,this.sx,this.sy,t,e,hw+z,hh+f,t*s,e*s)}ctx.restore()}this.cenX=this.x-this.mhWScaled,this.cenY=this.y-this.mhHScaled},this.isHero=function(){return this.type==H.HERO},this.isTile=function(){return!1},this.setT=function(t){this.type=t,this.setType()},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.isSolid=!1,this.type){case H.HERO:this.isSolid=!0,this.sx=0,this.sy=0;break;case H.BLOCK:this.isSolid=!0,this.sx=16;break;case H.DEAD:this.isSolid=!0;case H.SPIKE:this.sx=48,this.kills=!0;break;case H.LSPIKE:this.sx=48,this.angle=270,this.kills=!0;break;case H.RSPIKE:this.sx=48,this.angle=90,this.kills=!0;break;case H.TSPIKE:this.sx=48,this.angle=180,this.kills=!0;break;case H.DROPY:this.sx=48,this.sy=16,this.kills=!0;break;case H.BUTTON:this.sx=64;break;case H.FLOOR:this.sx=32,this.sy=32,this.alpha=.9;break;case H.PORTAL:this.sx=64,this.sy=16,this.alpha=.9,this.spin=!0;break;case H.AIR:this.sx=144;break;case H.DOOR:this.isSolid=!0,this.sx=32;break;case H.PILL:this.sx=16,this.sy=16;break;case H.PILR:this.sx=16,this.sy=16,this.flip=!0;break;case H.SPIN:this.sx=80,this.sy=16,this.spin=!0,this.kills=!0;break;case H.WALL:this.sy=32;break;case H.BRICK:this.sy=32,this.sx=32;break;case H.PILLE:this.sx=16,this.sy=32,this.flip=!0;break;case H.PILRE:this.sx=16,this.sy=32;break;case H.FALL:this.sx=48,this.sy=32,this.isSolid=!0,this.falls=!0;break;case H.CHK:this.sx=64,this.sy=32,this.chk=!0}},this.setType()}function q(t,i,s,h,n,a,r){this.e=new X(t,i,s,h,n,a,"",r,!1,100),this.hereos=[],this.active=!0,this.hp=2,this.particles=[];let l=null,o=!1,c=0,u=0,f=0,y=0,d=0,v=0,g=.1,m=Bt,w={x:this.e.x,y:this.e.y},b=[],k=0,T=.1,E=0,L=0,I=0,M=0,S=!1,P=!1,W=null;this.deaths=0,this.doneTime=0,this.done=!1,this.changeLevel=!1,this.update=function(t,e){if(this.time+=e,u+=e,(Math.abs(w.x-this.e.x)>20||Math.abs(w.y-this.e.y)>20)&&(!function(t,e,i){i.length>8&&i.splice(0,1);i.push({x:t,y:e,d:m})}(this.e.x,this.e.y,b),w={x:this.e.x,y:this.e.y}),this.active&&(Pt()||At()?(this.e.angle+=20,E+=e,f=f>5?5:f+=.5):(f=f>0?f-=.5:0,u<3&&(this.e.angle=0),E=0),(Pt()||f>0&&m==jt)&&(m=jt,this.e.x-=this.gMove(-1,0),this.e.flip=!0,!Pt()&&this.grounded()&&this.addDust()),(At()||f>0&&m==Bt)&&(m=Bt,this.e.x+=this.gMove(1,0),this.e.flip=!1,!At()&&this.grounded()&&this.addDust())),d<=0&&this.grounded()?o=!1:d>0&&(this.e.y-=this.gMove(0,-1,!1,!0),d-=e),v>0&&(v-=e),(Rt()||Dt())&&this.jump(),this.canFall&&g>=.1&&this.active?this.e.y+=this.gMove(0,1,!0,!1):!this.active&&L>0?this.e.y+=this.gMove(0,1,!1,!1):this.grounded()||(g+=e),this.grounded()&&0!=g&&!o&&(g=0),this.grounded()||(E=0),this.active&&null!=l){let t=l.entity.type;l.entity.kills?(this.bloodSplatter(!1,I,M),this.bloodDrip(l.entity),this.kill()):t!=H.BUTTON||l.entity.pressed?t==H.PORTAL?(this.bloodSplatter(!0,I,M),this.done||(x(ae,.6),this.doneTime=1,this.done=!0)):t==H.CHK&&l.e.chk&&(l.e.chk=!1,l.e.sx=80,(W=[])[0]=l.e.x,W[1]=l.e.y-16,x(ae,.2)):(mt.shakeTime=.1,l.entity.pressed=!0,l.entity.sx=80,mt.levels[this.e.curLevel].opendoors=!0,x(se,.8))}L>0?L-=e:L<=0&&!this.active&&(null!=W?(this.e.x=W[0],this.e.y=W[1]):(this.e.x=mt.levels[this.e.curLevel].startPos[0],this.e.y=mt.levels[this.e.curLevel].startPos[1]),this.active=!0,this.e.sy=0),this.doneTime>0&&(this.doneTime-=e,this.changeLevel=!0),(Rt()||Dt()||Ct()||At()||Pt())&&(u=0),u>3&&(this.e.angle+=40,this.particles.push(new p(C(10,30),0,this.e.x-this.e.mhWScaled,this.e.y+2.2*this.e.height-C(1,5),0,"dust",!1,m)),u>5&&(u=0)),t.save(),t.translate(mt.cam.x,mt.cam.y),this.hereos.forEach((e,i)=>(function t(e,i,s,h){if(i.constructor===Array&&k>0&&s==h)i.forEach((s,h)=>t(e,s,h,i.length-1));else if(k>0){let t=P?32:0;F(e,this.e.image,t,16,this.e.width,this.e.height,i.x,i.y,s/h+.3,r)}if(i.constructor===Array){let t=i[i.length-1];null!=t&&F(e,this.e.image,0,16,this.e.width,this.e.height,t.x,t.y,.7,r)}})(t,e,i,this.hereos.length-1)),t.restore();for(let i=0;i<=this.particles.length-1;i++)this.particles[i].update(t,e);if(this.e.update(e),(Ct()||this.trapped())&&this.active&&this.hereos.length>0)if(k=.1,T<=0){T=.1;let t=this.hereos[this.hereos.length-1],e=1==t.length?t[0]:t[t.length-2];rec=new R(e.x,e.y,this.e.hb.w,this.e.hb.h),K(this.e.hb,rec)&&this.active&&!this.trapped()?P=!0:(P=!1,this.hereos[this.hereos.length-1].pop(),0==this.hereos[this.hereos.length-1].length&&(this.hereos.splice(this.hereos.length-1,1),this.hp++,this.active=!0))}else T-=e;k>0&&(k-=e),E>.35&&this.addDust(),this.particles=this.particles.filter(function(t){return 0==t.remove}),this.grounded()?(c>.8&&(this.addDust(!0),mt.shakeTime=.08,x(le,.4)),c=0):c+=e,I=this.e.x-this.e.mhWScaled,M=this.e.y-this.e.mhHScaled,S&&(S=!1,f=0,this.kill(),this.hp>1&&this.hp++)},this.reset=function(){this.doneTime=0,this.done=!1,this.hereos=[],this.particles=[],this.hp=2,W=null;let t=mt.levels[this.e.curLevel];this.e.x=t.startPos[0],this.e.y=t.startPos[1]},this.kill=function(){this.active&&(this.deaths++,mt.shakeTime=.15,x(re,1),this.hp--,this.hereos.push(b),b=[],this.active=!1,L=.5,f=0,this.e.sy=16,0==this.hp&&(this.hereos.splice(this.hereos.length-1,1),this.hp++))},this.setCurrentTile=function(t){heroRow=Math.floor((this.e.y-this.e.mhHScaled)/t),heroCol=Math.floor((this.e.x-this.e.mhWScaled)/t),heroTileIndex=heroCol+mt.levels[this.e.curLevel].cols*heroRow,null!=l&&(this.prevTile=l),l=mt.level.tiles[heroTileIndex],this.e.x==w.x&&this.e.y==w.y||(this.e.colArr=[],mt.surTiles.forEach(t=>this.e.colArr.push(mt.level.tiles[heroTileIndex+t])),this.hereos.forEach(t=>(function(t,e){let i=t[t.length-1];if(null!=i){let t=new A(16,i.x,i.y,0,H.DEAD,!1,0,0,r,!1);t.entity.updateHitbox(),e.push(t)}})(t,this.e.colArr)))},this.addDust=function(t=!1){if(t)for(let t=0;t<C(5,10);t++)this.particles.push(new p(C(5,10),0,this.e.x-this.e.mhWScaled,this.e.y+2.2*this.e.height-C(1,5),0,"dust",!1,Bt)),this.particles.push(new p(C(5,10),0,this.e.x-this.e.mhWScaled,this.e.y+2.2*this.e.height-C(1,5),0,"dust",!1,jt));else for(let t=0;t<C(1,4);t++)this.particles.push(new p(C(1,15),0,this.e.x-this.e.mhWScaled,this.e.y+2.2*this.e.height-C(1,5),0,"dust",!1,m));E=0},this.canFall=function(){return this.gMove(0,1,!1,!1,!0)>0},this.trapped=function(){return 0==this.gMove(0,0,!1,!1,!1,!0)},this.jump=function(){(!o&&g<=.1&&this.active||this.wRide()&&v<=0)&&(v=.2,g=.1,o=!0,d=.5,y=13,x(he,.2))},this.grounded=function(){rec=j(this.e.hb),rec.y+=2,canJump=!1;for(var t=0;t<this.e.colArr.length;t++)if(obj=this.e.colArr[t],null!=obj&&null!=obj.entity&&(e=obj.entity,obj.isTile()&&K(e.hb,rec)&&obj.active&&e.isSolid&&rec.y>this.e.y)){e.falls&&!e.fall&&(e.fallTime=.2,e.fall=!0),canJump=!0;break}return canJump},this.wRide=function(){rec=j(this.e.hb),rec.x-=8,rec.w+=16,rec.y+=2,rec.h+=4,canJump=!1;for(var t=0;t<this.e.colArr.length;t++)if(obj=this.e.colArr[t],null!=obj&&null!=obj.entity&&(e=obj.entity,obj.isTile()&&obj.entity.type==H.DEAD&&K(e.hb,rec)&&obj.active&&e.isSolid&&rec.y>this.e.y)){canJump=!0;break}return canJump},this.gMove=function(t,i,s=!1,h=!1,n=!1,a=!1){this.e.idle=0;var r=s?7:f;h?r=y=(y-=.3)>0?y:0:n&&(r=1),a&&(r=1),rec=j(this.e.hb),rec.x+=t*r,rec.y+=i*r,canMove=!0,amount=r;for(var l=r;l>0;l--){canMove=!0;for(var o=0;o<this.e.colArr.length;o++)if(obj=this.e.colArr[o],null!=obj&&null!=obj.entity){if(e=obj.entity,obj.isTile()&&K(e.hb,rec)&&obj.active&&e.isSolid){canMove=!1;break}}else this.e.y>500&&(S=!0);if(canMove)break;amount--,rec.x-=t,rec.y-=i}return amount},this.bloodDrip=function(t){for(let e=1;e<10;e++)this.particles.push(new p(C(1,2),0,t.x+18+C(0,20),t.y+25+C(1,5),0,"bld",!1))},this.bloodSplatter=function(t,e,i){for(let s=0;s<30;s++)this.particles.push(new p(C(1,25),0,e,i,0,"circle",t)),this.particles.push(new p(C(1,8),0,e,i,0,t))}}let Q=window.innerWidth,Z=window.innerHeight,$=!1,_=0,tt=Date.now(),et=Date.now(),it=0,st=0,ht=new N(0,0),nt=new N(0,0),at,rt,lt=!1,ot=!1,ct=0,ut=!1,ft=!1,yt="990099",pt="05f2db",dt=!1,vt=1,xt=new Image;xt.src="atlas.png";let gt=!0,mt=new S,wt=!0,bt=!1,kt=[],Tt=!0,Et=!1;function startGame(){Lt.start()}y();let Lt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=Q,this.canvas.height=Z,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(It,20),mt.genLevel(0),mt.levels[0].tiles.forEach(t=>{t.entity.type>0&&kt.push(t)}),window.addEventListener("keydown",function(t){bt=!0,t.preventDefault(),Lt.keys=Lt.keys||[],Lt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){Lt.keys[t.keyCode]="keydown"==t.type,t.keyCode==te&&(ft=!0),t.keyCode==Vt&&(Et=!Et),t.keyCode==ee&&(mt.tips=!mt.tips)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}};function It(){if(ut&&(it=0,ut=!1,dt=!1,vt=0,bt=!1,$=!1,mt.genLevel(vt)),bt&&(null!=mt.hero&&(mt.hero.e.active=!0),$=!0,null==u&&(u=new AudioContext)),tt=et,et=Date.now(),it+=_=et-tt,$){Lt.clear(),mt.update(_/1e3,it),Mt(ctx,.1,"#"+yt,0,0,800,600);let t="15px Verdana";Ht(ctx,1,t,"WHITE","[M] Music: "+!Et,650,20),Ht(ctx,1,t,"WHITE","[T] Tips: "+mt.tips,650,40),Ht(ctx,1,t,"WHITE","[R] Reset Level",650,60),Ht(ctx,1,t,"WHITE","Lives: "+mt.hero.hp,10,40),Ht(ctx,1,t,"RED","Deaths: "+mt.hero.deaths,10,60),Ht(ctx,1,t,"WHITE","Level: "+(mt.hero.e.curLevel+1),10,20);let e=mt.hero.e.curLevel;mt.tips&&(0==e?Ht(ctx,1,t,"WHITE","Jump the gap and run over the button to reach the portal!",200,120):1==e?(Ht(ctx,1,t,"WHITE","Dont fear the reaper! Dying creates a soul platform!",230,80),Ht(ctx,1,t,"WHITE","Rewind your soul to previous positions with [E]",230,100)):2==e?(Ht(ctx,1,t,"WHITE","You can wall jump off your soul!",240,80),Ht(ctx,1,t,"WHITE","Avoid spikes and clear high ledges",240,100)):3==e?(Ht(ctx,1,t,"WHITE","Hit the button then reclaim your soul, Hold [E]",230,80),Ht(ctx,1,t,"WHITE","Re-use your soul on the second set of spikes!",230,100)):4==e?Ht(ctx,1,t,"WHITE","Run!!",280,120):5==e?Ht(ctx,1,t,"WHITE","Check points allow you to reclaim your soul and move on!",230,100):10==e&&(t="30px Verdana",Ht(ctx,1,t,"WHITE","Soul Jumper Completed!",230,100))),Et&&(h.pause(),Tt=!0),Tt&&n&&!Et&&(h.play(),h.loop=!0,Tt=!1)}else{Lt.clear(),ctx=Lt.context,mt.update(_,it,!0),ctx.save(),Mt(ctx,.1,"#"+yt,0,0,800,600),z=it/1600,Ht(ctx,1,"30px Verdana","WHITE","SOUL JUMPER",400+40*Math.cos(z),100+20*Math.sin(z));let t="20px Verdana";if(Ht(ctx,1,t,"WHITE","===== CONTROLS ======",50,40),Ht(ctx,1,t,"WHITE","[A][D] or [  ][  ] Left / Right",50,70),St(ctx,1,t,"WHITE","2190",155,70),St(ctx,1,t,"WHITE","2192",190,70),St(ctx,1,t,"WHITE","2191",190,100),Ht(ctx,1,t,"WHITE","[W] [Space] [  ] Jump",50,100),Ht(ctx,1,t,"WHITE","[E] Rewind Ghost",50,130),Ht(ctx,1,t,"WHITE","Code: @Carelesslabs",50,160),Ht(ctx,1,t,"WHITE","Music: @AdamTheWilliams",50,190),txt=n?"=== ANY KEY TO START === ":"====== LOADING ======",Ht(ctx,1,"20px Verdana","WHITE",txt,50,215),ctx.restore(),ctx.save(),ctx.translate(100,225),ctx.drawImage(xt,0,0,16,16,32,hh+f,32,32),ctx.restore(),mt.hero.time+=_,C(1,100)>97){mt.hero.bloodSplatter(!1,C(20,700),C(20,500));let t=kt[C(0,kt.length-1)];for(let e=1;e<5;e++)mt.hero.particles.push(new p(C(1,2),0,t.entity.x+18+C(0,20),15+t.entity.y,0,"bld",!1))}for(let t=0;t<=mt.hero.particles.length-1;t++)mt.hero.particles[t].update(ctx,_/1e3);mt.hero.particles=mt.hero.particles.filter(function(t){return 0==t.remove})}}function Mt(t,e,i,s,h,n,a){t.globalAlpha=e,t.fillStyle=i,t.fillRect(s,h,n,a)}function St(t,e,i,s,h,n,a){var r=eval('"\\u'+h+'"');t.globalAlpha=e,t.font=i,t.fillStyle=s,t.fillText(r,n,a)}function Ht(t,e,i,s,h,n,a){t.globalAlpha=e,t.font=i,t.fillStyle=s,t.fillText(h,n,a)}function Pt(){return Lt.keys&&(Lt.keys[jt]||Lt.keys[Jt])}function At(){return Lt.keys&&(Lt.keys[Bt]||Lt.keys[Yt])}function Rt(){return Lt.keys&&(Lt.keys[Kt]||Lt.keys[Ft])}function Wt(){return Lt.keys&&(Lt.keys[Nt]||Lt.keys[Ut])}function Dt(){return Lt.keys&&Lt.keys[Xt]}function Ot(){return Lt.keys&&Lt.keys[Vt]}function Ct(){return Lt.keys&&(Lt.keys[Qt]||Lt.keys[qt])}var jt=37,Bt=39,Kt=38,Nt=40,Ft=87,Jt=65,Ut=83,Yt=68,Vt=77,zt=0,Gt=2,Xt=32,qt=69,Qt=49,Zt=50,$t=51,_t=52,te=82,ee=84,ie=0,se=1,he=2,ne=3,ae=4,re=5,le=6,oe=7;